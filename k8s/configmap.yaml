---
apiVersion: v1
kind: ConfigMap
metadata:
  name: tinyllm-config
  namespace: tinyllm
  labels:
    app: tinyllm
data:
  # Service mesh configuration
  service-mesh.yaml: |
    mesh_type: istio  # or linkerd
    mtls_enabled: true

    # Istio specific
    istio:
      virtual_service_timeout: 30s
      retry_attempts: 3
      per_try_timeout: 10s
      circuit_breaker:
        max_connections: 100
        max_pending_requests: 50
        max_requests: 100

    # Linkerd specific
    linkerd:
      request_timeout: 30s
      backend_timeout: 10s
      retry_budget:
        retry_ratio: 0.2
        min_retries_per_second: 10
        ttl: 10s

  # Application configuration
  app-config.yaml: |
    server:
      host: 0.0.0.0
      port: 8000

    ollama:
      host: http://ollama:11434
      timeout_ms: 30000
      max_retries: 3

    redis:
      host: redis
      port: 6379
      db: 0

    telemetry:
      enable_tracing: true
      service_name: tinyllm
      exporter: otlp
      otlp_endpoint: http://otel-collector:4317
      sampling_rate: 1.0

    health:
      interval_seconds: 30
      timeout_seconds: 5
      failure_threshold: 3
      success_threshold: 2

    logging:
      level: info
      format: json

    cache:
      enabled: true
      backend: redis
      ttl_seconds: 3600
      max_size: 10000
