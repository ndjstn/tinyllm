# Example graph using FanoutNode for parallel model execution
# This demonstrates how to use fanout to query multiple models in parallel
# and aggregate their responses using different strategies

id: fanout.example
version: 1.0.0
name: Multi-Model Fanout Example
description: Demonstrates parallel execution with result aggregation

metadata:
  created_at: "2025-01-15"
  author: TinyLLM
  tags:
    - fanout
    - parallel
    - aggregation

nodes:
  # Entry point
  - id: entry
    type: entry
    name: Entry Node
    config: {}

  # Fanout to multiple models using ALL strategy
  - id: fanout.all_models
    type: fanout
    name: Query All Models
    description: Send query to all models and combine results
    config:
      target_nodes:
        - model.fast
        - model.accurate
        - model.creative
      aggregation_strategy: all  # Combine all results
      parallel: true
      timeout_ms: 10000

  # Fanout using FIRST_SUCCESS for speed
  - id: fanout.fast_response
    type: fanout
    name: Get Fastest Response
    description: Return first successful result
    config:
      target_nodes:
        - model.fast1
        - model.fast2
        - model.fast3
      aggregation_strategy: first_success  # Return first to complete
      parallel: true
      timeout_ms: 5000

  # Fanout using MAJORITY_VOTE for consensus
  - id: fanout.consensus
    type: fanout
    name: Consensus Decision
    description: Use majority vote from multiple models
    config:
      target_nodes:
        - model.voter1
        - model.voter2
        - model.voter3
        - model.voter4
        - model.voter5
      aggregation_strategy: majority_vote  # Most common answer wins
      parallel: true
      require_all_success: false

  # Fanout using BEST_SCORE for quality
  - id: fanout.best_quality
    type: fanout
    name: Best Quality Response
    description: Select highest quality response
    config:
      target_nodes:
        - model.quality1
        - model.quality2
        - model.quality3
      aggregation_strategy: best_score  # Highest scored result
      score_field: quality_score
      parallel: true

  # Sequential fanout with fail-fast
  - id: fanout.sequential
    type: fanout
    name: Sequential Fallback
    description: Try models in order, stop on first success
    config:
      target_nodes:
        - model.primary
        - model.fallback1
        - model.fallback2
      aggregation_strategy: first_success
      parallel: false  # Execute sequentially
      fail_fast: true  # Stop on first success

  # Model nodes (simplified for example)
  - id: model.fast
    type: model
    config:
      model: qwen2.5:0.5b

  - id: model.accurate
    type: model
    config:
      model: qwen2.5:3b

  - id: model.creative
    type: model
    config:
      model: qwen2.5:7b
      temperature: 0.9

  - id: model.fast1
    type: model
    config:
      model: qwen2.5:0.5b

  - id: model.fast2
    type: model
    config:
      model: qwen2.5:0.5b

  - id: model.fast3
    type: model
    config:
      model: qwen2.5:0.5b

  - id: model.voter1
    type: model
    config:
      model: qwen2.5:1.5b

  - id: model.voter2
    type: model
    config:
      model: qwen2.5:1.5b

  - id: model.voter3
    type: model
    config:
      model: qwen2.5:1.5b

  - id: model.voter4
    type: model
    config:
      model: qwen2.5:1.5b

  - id: model.voter5
    type: model
    config:
      model: qwen2.5:1.5b

  - id: model.quality1
    type: model
    config:
      model: qwen2.5:3b

  - id: model.quality2
    type: model
    config:
      model: qwen2.5:3b

  - id: model.quality3
    type: model
    config:
      model: qwen2.5:3b

  - id: model.primary
    type: model
    config:
      model: qwen2.5:7b

  - id: model.fallback1
    type: model
    config:
      model: qwen2.5:3b

  - id: model.fallback2
    type: model
    config:
      model: qwen2.5:1.5b

  # Exit point
  - id: exit
    type: exit
    name: Exit Node
    config: {}

# Define edges
edges:
  - from_node: entry
    to_node: fanout.all_models

  - from_node: fanout.all_models
    to_node: exit

# Entry and exit points
entry_points:
  - entry

exit_points:
  - exit

protected: []
